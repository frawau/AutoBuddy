<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Autobuddy by frawau</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <img src="images/AutoBuddy-logo.svg" height="100" width="100" style="float: left;"/>
        <h1>AutoBuddy</h1>
        <h2>A Home Automation system</h2>
        <a href="https://github.com/frawau/AutoBuddy" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
    <img src="images/AutoBuddy-logo.svg" height="50" width="50"/>
      <div class="inner clearfix">
        <section id="main-content">
          <h1>Introduction</h1>
          <p><em>AutoBuddy</em> is a would-be home automation system written in his spare time by François Wautier.
          It is distributed under the MIT license.</p>
          <p>This project was triggered by the purchase of a number of <a href="http://www.lifx.com">Lifx lightbulbs</a>.</p>
          <p><em>AutoBuddy</em> consists in a number of pieces of software communicating via simple messaging bus. At this time,
          March 2017, it should be considered beta software. AutoBuddy requires Python 3.5 or above.
          </p>
          <p>AutoBuddy's logo was designed by Khan Wautier.</p>
          <h1>Components</h1>
          <h2>Buddylib</h2>
          <p>Buddylib is a python library that defines the element known to the AutoBuddy ecosystem. It defines zone, various
          devices as well as some generic bridge functionalities. Buddylib depends on
          <a href="http://www.sqlalchemy.org/">SQLAlchemy</a>.</p>
          <h2>ControlBuddy</h2>
          <p>ControlBuddy is at the heart of AutoBuddy. It multiplexes all the messages going in and out of the bus. It controls the zones and their associated devices.
          It provides persistence services to other components.</p>
          <h2>LifxBuddy</h2>
          <p>LifxBuddy is a bridge application that provides control to <a href="http://www.lifx.com">Lifx lightbulbs</a>. It uses
          <a href="https://github.com/frawau/aiolifx">aiolifx</a> to communicate with the lightbulbs.</p>
          <h2>FlicBuddy</h2>
          <p>FlicBuddy is a bridge application that provides access to <a href="https://flic.io/">Flic Smart Button</a>. It uses
          <span style="font-style: italic;">aioflic</span> and <span style="font-style: italic;">flicd</span>, that can be found within
          <a href="https://github.com/50ButtonsEach/fliclib-linux-hci">fliclib-linux-hci</a> to communicate with the buttons. FlicBuddy requires the exclusive use of a
          Bluetooth adapter. More than one BuddyFlic can run as long as they have different subtypes. </p>
          <h2>PresenceBuddy</h2>
          <p>PresenceBuddy is a bridge application that provides presence information based on devices' MAC addresses. It uses
          <a href="https://github.com/frawau/aioarping">aioarping</a> to track MAC addresses on your LAN and/or <a href="https://github.com/frawau/aiobtname">aiobtname</a>
          to track Bluetooth MAC addresses. Tracking presence with Bluetooth is very reliable. Tracking presence using ARP request is much less reliable. We
          tested with LG G5, Samsung Galaxy 7, iPhone 4s, iPhone 7 all of them answered haphazardly to the ARP requests sent.</p>
          <h2>ActionBuddy</h2>
            <p>ActionBuddy is an application that processes events and act on them based on rules defined by the users. ActionBuddy also manages
            internal time events (granularity is 1 minute). ActionBuddy let the user define <span style="font-style: italic;">state variables</span>
            and <span style="font-style: italic;">rules</span>.</p>
            <p>State variables can be of type:
                <dl>
                    <dt>event</dt><dd>Keep track of some event value (or part thereof)</dd>
                    <dt>simple</dt><dd>A way to share information between rules</dd>
                    <dt>counter</dt><dd>Similar to a simple variable, but with integer operations.</dd>
                    <dt>tracker</dt><dd>A way to track entities associated with specific events/values.</dd>
                    <dt>time</dt><dd>A way to define time intervals</dd>
                </dl>
            </p>
            <p>Rules are defined by:
                <dl>
                    <dt>A trigger</dt><dd>An event/value or the resulting value of a state variable after an event.</dd>
                    <dt>A list of conditions</dt><dd>Each condition testing the value of a state variable.</dd>
                    <dt>A list of commands</dt><dd>A list of commands to be executed if all the condition have been met after the rule was triggerred.</dd>
                </dl>
            </p>
            <p>ActionBuddy will process all events in the following way:
                <ul>
                    <li>Update all the state variables that the event should update,</li>
                    <li>Check what rules are triggerred,</li>
                    <li>Check that all the conditions are met for the rules triggerred,</li>
                    <li>If all checks, execute the commands.</li>
                </ul>
            </p>
            <p>With ActionBuddy you can define rules that:
                <ul>
                    <li>Create a nice light show at sunset</li>
                        <li>Toggle a light at the push of a flic</li>
                        <li>Restore the state of your light after a power outage</li>
                        <li>Turns light On/Off depending on the time of day and the presence/absence of people</li>
                        <li>Send a Pushbullet message when a door is moved.</li>
                        <li>Have your wife prepare you breakfast when you wake up..... Oh wait! That is not working yet.</li>
                    <li>...</li>
                </ul>
            </p>
            <p>
            Note that all rules, conditions and commands are evaluated in lexicographic order, to make sure they are evaluated in the required order
            you should prefix all the names used with 010, 020, 030, and so on.
            </p>
            <p>
            Currently, ActionBuddy can send notifications using:
                <ul>
                    <li>Email</li>
                    <li><a href="https://slack.com/">Slack</a></li>
                    <li><a href="https://www.pushbullet.com/">Pushbullet</a></li>
                    <li><a href="https://pushover.net/">Pushover</a></li>
                </ul>
            </p>
          <h2>VoiceBuddy</h2>
          <p>VoiceBuddy is AutoBuddy's voice recognition module. It uses <a href="http://cmusphinx.sourceforge.net/">Carnegie Mellon University's PockectSphinx</a>.
          <p>VoiceBuddy allows you to define <span style="font-syle: italic;">utterances</span> and to trigger events when they are detected.</p>
          <p>There is a configurable trigger utterance. By default it is <span style="font-weight:bold;">listen buddy</span>.</p>
          <p>Whilst VoiceBuddy always uses PocketSphinx to detect the trigger utterance, it can be configure to uses other voice recognition engines:
              <dl>
              <dt>SimplePocketSphinx</dt><dd>This version of pocket sphinx is the one used for detecting the trigger utterance. It uses a dictionary limited to the
                   words defined in the various recognized voice commands. You can add words (like numeral for example) by listing them in a disabled voice command.
                   This method is working very well and with little delay.</dd>
              <dt>PocketSphinx</dt><dd>This uses the full dictionary that comes with PocketSphinx.</dd>
              <dt>Google</dt><dd>It you set an API key, it will use <a href="https://cloud.google.com/speech/">Google Cloud Speech API</a>, if no key is provided it will use the
               <a href="http://www.chromium.org/developers/how-tos/api-keys">Google Speech Recognition API</a> with no key. (Not sure I should...)</dd>
              <dt>Houndify</dt><dd>Uses the <a href="https://www.houndify.com">Houndify</a> engine. You need an id and key.</dd>
              <dt>Wit.ai</dt><dd>Uses <a href="https://wit.ai/">Wit.ai</a> engines. You must setup your own application on their website, and get a key.</dd>
              <dt>IBM</dt><dd>Uses <a href="https://www.ibm.com/watson/developercloud/text-to-speech/api/v1/">IBM Watson Text-to-Speech</a> engine. You must setup an
                account and get a key.</dd>
                <dt>Bing</dt><dd>Uses <a href="https://docs.microsoft.com/en-gb/azure/cognitive-services/speech/concepts#recognition-language">Bing</a> engine. You need
                an Azure account. This was not tested.</dd>
                </dl>
          <p>In general, to improve reliability, it is a good idea to use multi-syllables words when defining voice commands. Also try to separate similar sounding
          commands when possible. For instance, instead of "turn the lights on" and "turn the ligths off" use "turn on the lights" and "turn the light off". Another
          example, instead of "lock the door" and "unlock the door", use "do lock the door" and "unlock the door".</p>
          <p>In general, be aware that voice recognition does not work very well in noisy environments.</p>
          <p>VoiceBuddy uses a modified version of the python module <a href="https://github.com/frawau/speech_recognition">speech_recognition</a>.</p>
          <p>VoiceBuddy requires an Internet connection when configuring it. When using the PocketSphinx engine it does not require an Internet connection.</p>
          <p>Voice command can be parametrized by using "$$" in the phrase and "$1","$2", .... in the event value. For instance:</p>
              <dl><dt>Phrase</dt><dd>play $$ songs by $$</dd>
                  <dt>Event value</dt><dd>kodi play song artist $2 count $1</dd>
             </dl>
          <p>When presented with the utterance "Play five songs by the beach boys", the phrase will match and send the value "kodi play song artist the beach boys count five"</p>
          <p>This is currently not very useful since the rules cannot yet handle this.</p>
          <p>In the gui, you can request VoiceBuddy the raw text-to-speech result, click on the icon and switch it on."
          <p>There is now a visual feedback to indicate that VoiceBuddy is actively trying to recognize speech.</p>
          <h2>SocketBuddy</h2>
          <p>SocketBuddy provides 2-way communication between websocket and the AutoBuddy bus. It serves WebBuddy and also provides login service to
          WebBuddy. It uses <a href="http://aiohttp.readthedocs.io/en/stable/">aiohttp</a> Python library.</p>
          <h2>WebBuddy</h2>
          <p>WebBuddy is AutoBuddy web application. It enables the user, to create zones, associate devices with zone,
          send commands to the devices/zones, manage users, define rules, and so on.</p>
          <img src="images/webbuddy-snap.jpg" />
          <img src="images/webbuddy-light-control.jpg" />
          <p>WebBuddy depend on, among others:
              <ul>
              <li><a href="https://jquery.org/">jQuery and jQuery-ui</a></li>
              <li><a href="http://getbootstrap.com/">Bootstrap</a></li>
              <li>Bootstraps extensions: bootstrap-slider, bootstrap-switch, bootbox, ...</li>
              <li><a href="http://frawau.github.io/BuddyWheel/">BuddyWheel</a> a SVG/Javascript colourwheel
              that is a sub-project of ours.</li>
              </ul>
          </p>
          <img src="images/webbuddy-action-rule.jpg" />
          <p>WebBuddy uses BuddyGuiLib to render all the command and configuration described in XML by each modules on
          the bus.</p>
          <h2>KodiBuddy</h2>
          <p>KodiBuddy is a bridge allowing AutoBuddy to interact with <a href="https://kodi.tv/">Kodi</a> instances. </p>
          <p>It currently offers the following functions
          <dl>
          <dt>Remote control</dt><dd>A simple remote control available only as a device command.</dd>
          <dt>Player Commands</dt><dd>A few, simple, player commands: play, pause, play/pause toggle, stop, next and, previous. Only available
          defining commands (<span style="font-style: italic;"><span style="font-style: italic;">e.g.</span></span> in ActionBuddy). </dd>
          <dt>Play Album</dt><dd>Play a random or a specific album. The album title can be specified. One can use "%" and "_" to represent "any string" and "any character respectively. The offset is to specify which one to select when more than 1 album meet the given title.</dd>
          <dt>Play Music</dt><dd>Plays a set number of albums or songs. One can specify a music genre or more. (You can use "_" to supply multi-words genres)</dd>
          <dt>Play Song</dt><dd>Play a random or a specific song. The song title can be specified. One can use "%" and "_" to represent "any string" and "any character respectively. The offset is to specify which one to select when more than 1 song meet the given title.</dd>
          <dt>Play Music Video</dt><dd>Play a random or a specific music video. The music video title can be specified. One can use "%" and "_" to represent "any string" and "any character respectively. The offset is to specify which one to select when more than 1 music video meet the given title.</dd>
          <dt>Play Movie</dt><dd>Play a random or a specific movie. The movie title can be specified. One can use "%" and "_" to represent "any string" and "any character respectively. The offset is to specify which one to select when more than 1 movie meet the given title.</dd>
          <dt>Power</dt><dd>Turning the Kodi device power "On" or "Off". For "On" to work, the device must be configured to respond to "Wake-On-LAN" packets. By default
          the "Off" command tells the Kodi device to shutdown. One can configure the Kodi mudule to use "quit" for a specific device.</dd>
          </dl></p>
          <p>When the device if deemed "Off", only the power command is available as device command.</p>
          <p>KodiBuddy talks to kodi devices using the <a href="http://kodi.wiki/?title=JSON-RPC_API">JSON-RPC</a> protocol over WebSocket.</p>
          <h2>ScannerBuddy</h2>
          <p>ScannerBuddy scans the network looking for Avahi/Bonjour services. It reports newly discoverd service, as well as known service where the IP address has changed. It can be asked for "known services" and can be asked to perform a scan for a specific service (<span style="font-style: italic;">e.g.</span> _xbmc-jsonrpc._tcp.local.)</p>
          <h2>BLEBuddy</h2>
          <p>BLEBuddy monitors the bluetooth LE airwaves for advertised packets. It then uses plugins to decode the information and send it onto the AutoBuddy bus.</p>
          <p>At this time (July 2017) there is a <a href="https://tag.ruuvi.com/">Ruuvi Tag</a> plugin. It can decode the temperature, atmospheric pressure, huminidity, and accelerometer values. It will also decode battery information if present. The accelerometer can be calibrated. If you want to use Ruuvi Tag to detect movement, you should use an updated firmware, for instance <a href="https://drive.google.com/open?id=0B-JicGkaZAeXLU9ydHdURGxfRlU"> this one</a>, the sources are available in the ruuvi_tag repository.</p>
          <p>Ctrl-click on the icon will show the current values of the sensors.</p>
          <h2>LoggerBuddy</h2>
          <p>LoggerBuddy allows you to persist values associated with events. The data can then be graphed by WebBuddy. For instance Ruuvi Tag temperature measurements.</p>
          <img src="images/temp-graph.png" />
          <p>To be graphed, data must be numerical or have at most 2 or 3 distinct values (for instance "on" and "off"). As long as they are displayed, graphs are updated in real time.</p>
          <h2>ThingsBoardBuddy</h2>
          <p>ThingsBoardBuddy allows you to persist values associated with events on <a href="https://thingsboard.io/">ThingsBoard</a>. The data can then be graphed. <a href="https://demo.thingsboard.io/dashboards/27038000-6d0e-11e7-84e9-c7f326cba909?publicId=c5792950-67ab-11e7-84e9-c7f326cba909">Here is an example.</a> with data from RuuviTags and some lights. ThingsBoardBuddy uses <a href="http://coap.technology/">CoAP</a>.</p>
          <h2>I2CBuddy</h2>
          <p>I2CBuddy bridges I2C sensors. At this time (Oct 2017), there are 3 available plugins:</p>
          <ul>
              <li>BMP180: A sensor that can give you temperature in °C and atmospheric pressure in Pa,</li>
              <li>BH1750: A sensor that gives you luminosity in lux,</li>
              <li>HTU21D: A sensor that gives you temperature in °C and relative humidity in percent.</li>
          </ul>
          <p>By default no plugin will run. Plugins must be enabled in the device configuration using WebBuddy.</p>
          <p>I2CBuddy broadcast measurement events. The frequency of each measurement can be set in the configuration.</p>
          <p>Ctrl-click on the icon will show the current values of the sensors.</p>

          <h2>WeMoBuddy</h2>
          <p>WeMoBuddy is a set of bridges to access <a href="http://www.belkin.com/us/c/home-automation/">Belkin's WeMo products</a>. At this time switches (WeMoSwitchBuddy)
          and motion sensors (WeMoMotionBuddy) are supported.These bridges use the library aioouimeaux. </p>
          <h2>XiaomiBuddy</h2>
          <p>XiaomiBuddy is a bridge application that provides control to <a href="https://www.yeelight.com/en_US/product/wifi-led-c">Xiaomi Yeelight lightbulbs</a>. It uses
          <a href="https://github.com/frawau/aioziaomi">aioxiaomi</a> to communicate with the lightbulbs.</p>
          <h2>ConfigBuddy</h2>
          <p>ConfigBuddy is a an application use for the initial configuration of the system.</p>

          <h2>BuddyTools</h2>
          <p>BuddyTools is a set of tools that can be used to trigger event from other application. Currently there is:
          <dl>
          <dt>dhcp-event</dt><dd>This tool is a PHP script that can be used with the dhcp server in dnsmasq to trigger
          presence events based on dhcp lease events. It is a PHP script because I am using dd-wrt on my router and dd-wrt has a PHP interpreter but no
          Python interpreter. It is used with the dhcp-script config option. Events send from this tool can be detected by PresenceBuddy even
          when not using the ARPing method for presence. It generates <span style="font-weight: bold;">dhcp</span> events with as value a dictionary with
          <ul><li>status (online/offline)</li>
          <li>mac, the mac address</li>
          <li>ip, the ip address</li>
          <li>hostname</li>
          </ul>
          </dd>
          <dt>apcupsd-event</dt><dd>A python script meant to be used as <span style="font-weight: bold;">powerout</span> and
          <span style="font-weight: bold;">mainsback</span> scripts for apcupsd UPS monitoring daemon. It generates <span style="font-weight: bold;">grid power</span>
          events with value <span style="font-weight: bold;">grid power on</span> or <span style="font-weight: bold;">grid power off</span></dd>
          </dl>

          <h2>Others</h2>
          <p>As time goes by, many other components should appear here. For instance:
              <dl>
              <dt>LocationBuddy</dt><dd>Locating people in specific zone</dd>
              <dt>HayoBuddy</dt><dd>Support for <a href="https://hayo.io/">Hayo</a></dd></dd>
              <dt>...</dt>
              </dl>
          </p>

          <h1>Documentation</h1>
          <p>Description of the messages and their function is somewhat documented on
          <a href="https://docs.google.com/document/d/12_5Gr2zif0sSP3OtA12iZu0asv9sjVAy4ApaRnveBOw/edit?usp=sharing">Google Drive</a>. It is currently woefully outdated.</p>
          <h1>Status</h1>
          <h3>End of October 2017</h3>
          <p>Added support for multiple speech-to-text engines in VoiceBuddy</p>
          <h3>October 2017</h3>
          <p>Added I2CBuddy.</p>
          <h3>June 2017</h3>
          <p>Added KodiBuddy and ScannerBuddy.</p>
          <p>Module can now send specific devices information. The information can be accesses by Ctrl-Click'ing the device icon.</p>
          <p>Added Location and RemoteControl widgets to buddyguilib.</p>
          <p>In buddyguilib, a command can now be specified to appear only when defining actions (attribute <code>rteffect</code> not defined ot == 0), both when
          defining actions and in the device's realtime command panel (<code>rteffect</code> == 1) or only in the  device's realtime command panel (<code>rteffect</code> == -1)</p>
          <p>In buddyguilib, appearance of commands in the device's command panel can be predicated to a state value with the <code>onlyif</code> attribute. For instance
          to ensure that a command appears only if the device in "On" you can set <code>onlyif="power::on"</code> (Kodi) or  <code>onlyif="power::power::on"</code> (Lifx).
          <code>onlyif</code> is effective only when <code>rteffect == 1 or -1</code></p>
          <p>Device icons in WebBuddy can now be animated.</p>
          <h3>March 2017</h3>
          <p>System is soon to have its first release.</p>
          <p>I have it installed on a Raspberry Pi 3 with 10 Lifx and 6 flics and I use it everyday. It just works.</p>
          <p>Before release, I want to solve a couple of annoying bugs. I also want to add a location widget
          for BuddyGuiLib so that it is more convenient for people to set their location (needed for sunrise/sunset time)
          event though ConfigBuddy gets your location allright.</p>
          <h3>October 2015</h3>
          <p>System released on an unsuspecting world. Chaos may ensue.</p>
          <p>The system is minimal. At this time we can
            <ul>
            <li>Create zone</li>
            <li>Name zone</li>
            <li>Name device</li>
            <li>Associate devices with zone</li>
            <li>Control Lifx device (On/Off, Set Colour, Set White/Temperature</li>
            <li>On/Off devices in zone</li>
            <li>Manage users</li>
            </ul>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/frawau/AutoBuddy/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/frawau/AutoBuddy/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/frawau/AutoBuddy"></a> is maintained by <a href="https://github.com/frawau">frawau</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>


  </body>
</html>
